
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Vagrant: Broken Networking When Packaging Ubuntu Boxes - AbleCoder</title>
  <meta name="author" content="Brandon Orther">

  
  <meta name="description" content="When packaging my Vagrant virtual environment (Ubuntu server with a host-only
network) to a box file I ran into a problem. The issue was that when I &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://able.cd/b/2012/04/09/vagrant-broken-networking-when-packaging-ubuntu-boxes">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="AbleCoder" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-30262836-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">AbleCoder</a></h1>
  
    <h2>Pursuing efficacy in the art of software development.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:able.cd" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Vagrant: Broken Networking When Packaging Ubuntu Boxes</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-09T18:25:00-07:00" pubdate data-updated="true">Apr 9<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>When packaging my <a href="http://vagrantup.com/">Vagrant</a> virtual environment (Ubuntu server with a host-only
network) to a box file I ran into a problem. The issue was that when I tried to use that box file the
host-only network would not work.</p>

<p>With a little investigating I realized the problem was caused by the device name for the network
adapter being <code>eth2</code> instead of <code>eth1</code>. Vagrant uses <code>eth1</code> in the host-only network interface
defined in the <code>/etc/network/interfaces</code> file. Since <code>eth1</code> network interface doesn&#8217;t
exist (it is <code>eth2</code>) our host-only network does not work.</p>

<!-- more -->


<h2>The Cause</h2>

<p>Ubuntu uses <a href="http://wiki.debian.org/udev">udev</a> to dynamically set device names (<code>eth1</code> for example).
Ubuntu stores persistent udev rules for network devices in the
<code>/etc/udev/rules.d/70-persistent-net.rules</code> file. Below is the <code>70-persistent-net.rules</code> file from
the broken host-only network VM.</p>

<figure class='code'><figcaption><span>/etc/udev/rules.d/70-persistent-net.rules</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># PCI device 0x8086:0x100e (e1000)</span>
</span><span class='line'><span class="nv">SUBSYSTEM</span><span class="o">==</span><span class="s2">&quot;net&quot;</span>, <span class="nv">ACTION</span><span class="o">==</span><span class="s2">&quot;add&quot;</span>, <span class="nv">DRIVERS</span><span class="o">==</span><span class="s2">&quot;?*&quot;</span>, ATTR<span class="o">{</span>address<span class="o">}==</span><span class="s2">&quot;08:00:27:57:fd:7b&quot;</span>, ATTR<span class="o">{</span>dev_id<span class="o">}==</span><span class="s2">&quot;0x0&quot;</span>, ATTR<span class="o">{</span><span class="nb">type</span><span class="o">}==</span><span class="s2">&quot;1&quot;</span>, <span class="nv">KERNEL</span><span class="o">==</span><span class="s2">&quot;eth*&quot;</span>, <span class="nv">NAME</span><span class="o">=</span><span class="s2">&quot;eth0&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># PCI device 0x8086:0x100e (e1000)</span>
</span><span class='line'><span class="nv">SUBSYSTEM</span><span class="o">==</span><span class="s2">&quot;net&quot;</span>, <span class="nv">ACTION</span><span class="o">==</span><span class="s2">&quot;add&quot;</span>, <span class="nv">DRIVERS</span><span class="o">==</span><span class="s2">&quot;?*&quot;</span>, ATTR<span class="o">{</span>address<span class="o">}==</span><span class="s2">&quot;08:00:27:53:22:32&quot;</span>, ATTR<span class="o">{</span>dev_id<span class="o">}==</span><span class="s2">&quot;0x0&quot;</span>, ATTR<span class="o">{</span><span class="nb">type</span><span class="o">}==</span><span class="s2">&quot;1&quot;</span>, <span class="nv">KERNEL</span><span class="o">==</span><span class="s2">&quot;eth*&quot;</span>, <span class="nv">NAME</span><span class="o">=</span><span class="s2">&quot;eth1&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can see there exists a rule for <code>eth1</code>. The reason the host-only network adapater is assigned
<code>eth2</code> instead of <code>eth1</code> is because it&#8217;s MAC address doesn&#8217;t match the udev rule. The reason the MAC
address doesn&#8217;t match is because when Vagrant creates a new VM (from the box file) VirtualBox by
default generates a random MAC address for that network adapter.</p>

<h2>The Solution</h2>

<p>The solution is to remove the persitant network udev rules immediately before you package the box
file. This allows network adapters to be assigned device names without any MAC address issues.</p>

<h4>Packaging Steps</h4>

<ol>
<li><p>SSH into running VM and remove the persistant network udev rules file:</p>

<p> <code>sudo rm /etc/udev/rules.d/70-persistent-net.rules</code></p></li>
<li><p>Shutdown the VM and package it:</p>

<p> <code>vagrant halt &amp;&amp; vagrant package</code></p></li>
</ol>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Brandon Orther</span></span>

      








  


<time datetime="2012-04-09T18:25:00-07:00" pubdate data-updated="true">Apr 9<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/networking/'>Networking</a>, <a class='category' href='/blog/categories/ubuntu/'>Ubuntu</a>, <a class='category' href='/blog/categories/vagrant/'>Vagrant</a>, <a class='category' href='/blog/categories/virtualbox/'>VirtualBox</a>, <a class='category' href='/blog/categories/udev/'>udev</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://able.cd/b/2012/04/09/vagrant-broken-networking-when-packaging-ubuntu-boxes/" data-via="AbleCoder" data-counturl="http://able.cd/b/2012/04/09/vagrant-broken-networking-when-packaging-ubuntu-boxes/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/b/2012/03/24/the-reason-i-blog-future-me/" title="Previous Post: The reason I blog: Future-Me">&laquo; The reason I blog: Future-Me</a>
      
      
        <a class="basic-alignment right" href="/b/2012/05/28/rename-google-drive-default-folder/" title="Next Post: Rename Default Google Drive Folder">Rename Default Google Drive Folder &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/b/2012/05/28/rename-google-drive-default-folder/">Rename Default Google Drive Folder</a>
      </li>
    
      <li class="post">
        <a href="/b/2012/04/09/vagrant-broken-networking-when-packaging-ubuntu-boxes/">Vagrant: Broken Networking When Packaging Ubuntu Boxes</a>
      </li>
    
      <li class="post">
        <a href="/b/2012/03/24/the-reason-i-blog-future-me/">The reason I blog: Future-Me</a>
      </li>
    
  </ul>
</section>


<section class="twitter">
  <a class="twitter-timeline" href="https://twitter.com/AbleCoder" data-widget-id="444740599627784192">Tweets by @AbleCoder</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/AbleCoder?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/AbleCoder">My Delicious Bookmarks &raquo;</a></p>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Brandon Orther -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'ablecoder';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://able.cd/b/2012/04/09/vagrant-broken-networking-when-packaging-ubuntu-boxes/';
        var disqus_url = 'http://able.cd/b/2012/04/09/vagrant-broken-networking-when-packaging-ubuntu-boxes/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
